<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com._3dhs.tnproject.member.dao.MemberMapper">
<resultMap id="profileMap" type="com._3dhs.tnproject.member.dto.ProfileDTO">
    <id property="memberCode" column="member_code"/>
</resultMap>


<!--<resultMap id="profileMap" type="com._3dhs.tnproject.member.dto.ProfileDTO">-->
<!--    <id property="memberCode" column="member_code"/>-->
<!--</resultMap>-->
<resultMap id="memberMap" type="com._3dhs.tnproject.member.dto.MemberDTO">
    <id property="memberCode" column="member_code"/>
    <result property="memberId" column="member_id"/>
    <association property="profile" resultMap="profileMap"/>
</resultMap>

    <select id="findByMemberId" resultType="com._3dhs.tnproject.member.dto.MemberDTO">
        SELECT
            m.*, p.*
        FROM
            tbl_member m
        LEFT JOIN
            tbl_profile p ON m.member_code = p.p_member_code
        <where>
            <if test="memberId != null">
                AND m.member_id = #{memberId}
            </if>
        </where>
    </select>

    <select id="selectMemberById" resultType="string">
        SELECT
        member_id
        FROM
        tbl_member
        <where>
            <if test="memberId != null">
                AND member_id = #{memberId}
            </if>
            AND is_deleted = 0
        </where>
    </select>

    <insert id="insertMember">
        INSERT INTO
            tbl_member (member_id, member_pwd, member_gender, member_age, member_birth, member_subdate, member_status,
                      have_tissue, member_authority)
        VALUES
            (#{ memberId }, #{ memberPwd }, #{ memberGender }, #{ memberAge }, #{ memberBirth }, now(),
             'ACTIVE', 0, 'COMMON')
    </insert>

    <update id="updateMember">
        UPDATE
            tbl_member
        SET
           member_gender = #{ memberGender },
           member_age = #{ memberAge },
           member_birth = #{ memberBirth }
        <where>
            <if test="memberCode != null">
                member_code = #{ memberCode }
            </if>
        </where>
    </update>

    <update id="deleteMember">
        UPDATE
            tbl_member
        SET
            member_status = #{ memberStatus },
            delete_trans_date = now(),
            is_deleted = #{ isDeleted }
        <where>
            <if test="memberCode != null">
                member_code = #{ memberCode }
            </if>
        </where>
    </update>
</mapper>